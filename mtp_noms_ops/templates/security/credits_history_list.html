{% extends 'base.html' %}
{% load i18n %}
{% load mtp_common %}
{% load security %}

{% block page_title %}{{ view.title }} â€“ {{ block.super }}{% endblock %}


{% block inner_content %}
<header>
  <h1 class="heading-xlarge">{{ view.title }}</h1>
</header>

<aside class="mtp-object-list-toggle print-hidden">
  <a href="{% url 'security:check_list' %}" class="button-secondary">{% trans 'View pending' %}</a>
</aside>

{% include 'mtp_common/includes/message_box.html' %}

<p class="font-large">
  {% blocktrans trimmed count count=form.total_count with number=form.total_count|separate_thousands %}
  {{ number }} credit
  {% plural %}
  {{ number }} credits
  {% endblocktrans %}
</p>

<div class="mtp-results-list mtp-check-list">
<table class="mtp-table table-font-xsmall">
  <thead>
    <tr>
      <th>{% trans 'Date sent' %}</th>
      <th>{% trans 'Debit card (from)' %}</th>
      <th>{% trans 'Prisoner (to)' %}</th>
      <th>{% trans 'Amount' %}</th>
      <th>{% trans 'Decision' %}</th>
    </tr>
  </thead>
  <tbody>
    {% for check in objects %}
    <tr class="mtp-check-row">
      <td class="mtp-check-date">
        {{ check.credit.started_at|date:'SHORT_DATETIME_FORMAT' }}
      </td>
      <td>
        <a href="{{ check.credit|sender_profile_search_url }}" class="mtp-print-url-hidden">{{ check.credit.sender_name }}</a>
        <br/>
        {{ check.credit|format_card_number }}
        &nbsp;
        {{ check.credit.card_expiry_date }}
        <br/>
        {{ check.credit.sender_email }}
        <br/>
        {{ check.credit.billing_address.postcode }}
      </td>
      <td>
        <a href="{{ check.credit|prisoner_profile_search_url }}" class="mtp-print-url-hidden">{{ check.credit.prisoner_name }}</a>
        <br/>
        {{ check.credit.prisoner_number }}
        <br/>
        {{ check.credit.prison_name }}
      </td>
      <td>
        {{ check.credit.amount|currency }}
      </td>
      <td>
        {% if check.status == 'accepted' %}
          <p class="mtp-accepted-tag">{{ check.status|upper }}</p>
        {% else %}
          <p class="mtp-rejected-tag">{{ check.status|upper }}</p>
        {% endif %}
        {% trans 'by' %}
        {{ check.actioned_by_name }}
      </td>
    </tr>
    <tr class="mtp-check-description-row">
      <td></td>
      <td colspan="4">
        {{ check.description }}
        {% if check.decision_reason %}
          <br/>
          <br/>
          <strong>{% trans 'Decision details:' %}</strong>
          {{ check.decision_reason }}
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5">{% trans 'There are no actioned credits.' %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>

<div class="mtp-page-list__container">{% page_list page=form.cleaned_data.page page_count=form.page_count query_string=form.query_string %}
  <p class="mtp-page-list__count">
    {% blocktrans trimmed count count=form.total_count with number=form.total_count|separate_thousands %}
    {{ number }} credit
    {% plural %}
    {{ number }} credits
    {% endblocktrans %}
  </p>
</div>
{% endblock %}
