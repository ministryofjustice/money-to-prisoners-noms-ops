{% extends 'base.html' %}
{% load i18n %}
{% load security %}

{% block content %}
  <header class="ContentHeader">
    <a href="{% url 'security:dashboard' %}" class="ContentHeader-back">{% trans 'Home' %}</a>
    <h1>{{ view.title }}</h1>
  </header>

  {% include 'mtp_common/includes/message_box.html' %}

  <form method="get">
    {% include 'mtp_common/forms/error-summary.html' with form=form only %}

    <input type="hidden" name="page" value="1">

    <div class="grid-row">
      <aside class="UpdateFilterForm column-third">
        <h3>{% trans 'Edit your search' %}</h3>

        {% include view.form_template_name|default:'security/form.html' with view=view form=form only %}

        <div class="form-group">
          <button type="submit" class="button">{% trans 'Update search' %}</button>
        </div>
      </aside>

      <div class="ResultsList column-two-thirds">
        <h3>{% trans 'Results' %}</h3>
        {% include 'mtp_common/forms/field.html' with field=form.ordering only %}

        <table>
          <caption></caption>
          <thead>
            <tr>
              <th>{% trans 'Prisoner' %}</th>
              <th>{% trans 'Prison' %}</th>
              <th>{% trans 'Intended recipient' %}</th>
              <th>{% trans 'Amount (£)' %}</th>
              <th>{% trans 'Payment method' %}</th>
              <th>{% trans 'Date received' %}</th>
              <th>{% trans 'Processed by' %}</th>
            </tr>
          </thead>
          <tbody>
            {% for credit in credits|parse_date_fields %}
              <tr>
                <td>
                  {{ credit.prisoner_name }}
                  {% if credit.prisoner_number %}
                    (<a href="{% url 'security:credits' %}?page=1&amp;prisoner_number={{ credit.prisoner_number }}">{{ credit.prisoner_number }}</a>)
                  {% endif %}
                </td>
                <td>{{ credit.prison_name }}</td>
                <td>{{ credit.intended_recipient|default:'' }}</td>
                <td>{{ credit.amount|currency }}</td>
                <td>
                  {% if credit.source == 'online' %}
                    {% trans 'Debit card' %}
                  {% else %}
                    {% trans 'Bank transfer' %}
                  {% endif %}
                </td>
                <td>{{ credit.received_at|date:'DATE_FORMAT' }}</td>
                <td>{{ credit.owner_name|default_if_none:'—' }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7">{% trans 'No matching credits found' %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        {% include 'security/pagination.html' with page_count=form.page_count page_range=form.page_range query_string=form.query_string %}
      </div>
    </div>

  </form>

{% endblock content %}
