{% extends 'base.html' %}
{% load i18n %}
{% load mtp_common %}
{% load security %}

{% block inner_content %}

  <header>
    {% language_switch %}
    <h1 class="heading-xlarge">{{ view.title }}</h1>
  </header>

  {% include 'mtp_common/includes/message_box.html' %}
  {% include view.help_template_name %}

  <form method="get">
    {% include 'mtp_common/forms/error-summary.html' with form=form only %}

    <input type="hidden" name="page" value="1">

    <div class="grid-row">
      <aside class="mtp-results-form__wrapper column-third">
        <h2 class="heading-medium">{% trans 'Edit your search' %}</h2>

        {% include view.form_template_name with view=view form=form only %}

        <div class="form-group mtp-results-form__submit">
          <button type="submit" class="button">{% trans 'Update search' %}</button>
        </div>
      </aside>

      {% if form.cleaned_data %}
      <div class="mtp-results-list column-two-thirds">
        <h2 class="heading-large">{% trans 'Results' %}</h2>

        <div class="print-hidden">
          {% include 'security/select-field.html' with field=form.ordering only %}
        </div>
        <p class="mtp-search-description__text">
          {{ form.search_description }}
        </p>

        <table>
          <thead>
            <tr>
              <th>{% trans 'Prisoner' %}</th>
              <th>{% trans 'Prison' %}</th>
              <th>{% trans 'Received' %}</th>
              <th>{% trans 'Senders' %}</th>
              <th>{% trans 'Value (Â£)' %}</th>
            </tr>
          </thead>
          <tbody>
            {% for prisoner in prisoners %}
              <tr {% if forloop.last %}class="no-border"{% endif %}>
                <td>
                  <a href="{% url 'security:prisoner_detail' prisoner.id %}">
                  {{ prisoner.prisoner_number }}
                  </a>
                  <br/>
                  {{ prisoner.prisoner_name }}
                </td>
                <td>{{ prisoner.prisons }}</td>
                <td>
                  {% blocktrans count count=prisoner.credit_count %}
                    {{ count }} credit received
                  {% plural %}
                    {{ count }} credits received
                  {% endblocktrans %}
                </td>
                <td>
                  {% blocktrans count count=prisoner.sender_count %}
                    {{ count }} sender
                  {% plural %}
                    {{ count }} senders
                  {% endblocktrans %}
                </td>
                <td>{{ prisoner.credit_total|currency }}</td>
              </tr>
            {% empty %}
              <tr class="no-border">
                <td colspan="7">{% trans 'No matching credits found' %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        {% page_list page=form.cleaned_data.page page_count=form.page_count query_string=form.query_string %}
      </div>
      {% endif %}
    </div>

  </form>

{% endblock %}
