{% extends 'base.html' %}
{% load i18n %}
{% load mtp_common %}

{% block page_title %}{{ view.title }} – {{ block.super }}{% endblock %}

{% block proposition_extra %}
  {% if can_navigate_away %}
    {{ block.super }}
  {% else %}
    <nav id="mtp-proposition-extra" class="column-full print-hidden"></nav>
  {% endif %}
{% endblock %}

{% block inner_content %}

  {% if prison_choice_available %}
    <header>
      <h1 class="heading-xlarge mtp-slim-heading">{{ view.title }}</h1>
    </header>

    <div class="grid-row">
      <div class="column-two-thirds">

        <form method="post" class="mtp-autocomplete mtp-choose-prison">
          {% csrf_token %}

          {% if form.errors %}
            <div class="error-summary" aria-labelledby="error-summary-heading" tabindex="-1" role="alert">
              <h2 class="heading-medium error-summary-heading" id="error-summary-heading">
                {% trans 'There is a problem' %}
              </h2>
              <ul class="error-summary-list">
                {% get_form_errors form as errors %}

                {% for error in errors.non_field %}
                  <li class="non-field-error">{{ error }}<span class="visually-hidden">.</span></li>
                {% endfor %}

                {% for field, field_errors in errors.field_specific.items %}
                  {% for field_error in field_errors %}
                    <li class="field-specific-error">
                      <a href="#{{ field.id_for_label }}-label">{{ field_error }}<span class="visually-hidden">.</span></a>
                    </li>
                  {% endfor %}
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <div class="mtp-prison-list">
            {% for prison, label, removal_link in form.selected_prisons %}
              <div class="mtp-prison-row">
                <div class="mtp-prison-row__prison">
                  <strong>{{ label }}</strong>
                </div>
                <div class="mtp-prison-row__remove">
                  <a href="?{{ removal_link }}" data-analytics="event,PrisonConfirmation,Remove,{{ prison }}">{% trans 'Remove' %}</a>
                </div>
              </div>
            {% endfor %}
          </div>

          {% if form.all_prisons_code in form.prisons.initial %}
            <div class="mtp-info-box">
              <div class="mtp-info-box__heading">{% trans 'The data you see will be more useful if you confirm prisons relevant to you' %}</div>
              <br/>
              <div>
                {% trans 'If you’re happy with ‘All prisons’, click ‘Confirm prisons’.' %}
                {% trans 'If not, select and add the prisons you want.' %}
              </div>
            </div>
          {% endif %}

          {% include 'mtp_common/forms/select-field.html' with field=form.new_prison input_classes='mtp-autocomplete mtp-choose-prison-select' attrs=data_attrs only %}

          <div class="form-group mtp-choose-prisons">
            <button type="submit" name="submit_choose" class="mtp-choose-prisons__add-button button-secondary">
              {% trans 'Add prison' %}
            </button>
            <div class="mtp-choose-prisons__add-all">
            <a href="?prisons={{ form.all_prisons_code }}" data-analytics="event,PrisonConfirmation,Add,ALL">{% trans 'Add all prisons' %}</a>
            </div>
          </div>

          <span class="hidden">
            {{ form.prisons }}
          </span>
          <div class="form-group">
            <button type="submit" name="submit_confirm" class="button" data-current-prisons="{{ current_prisons }}">
              {% trans 'Confirm prisons' %}
            </button>
          </div>
        </form>

      </div>
    </div>
  {% else %}
    <header>
      <h1 class="heading-large">{% trans 'You cannot choose your prisons at this time' %}</h1>
    </header>
  {% endif %}

{% endblock %}
